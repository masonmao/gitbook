# top详解

## 说明

top命令的输出如下：

![1575686796915](C:\Users\maoxiangxin\AppData\Roaming\Typora\typora-user-images\1575686796915.png)

- **第一行：系统运行时间和平均负载**

当前时间、系统已运行时间、当前登录用户的数量、最近5、10、15分钟内的平均负载

- **第二行：任务**

任务的总数、运行中(running)的任务、休眠(sleeping)中的任务、停止(stopped)的任务、僵尸状态(zombie)的任务

- **第三行：cpu状态**

| 字段 | 字段释义                                                     |
| ---- | ------------------------------------------------------------ |
| us   | user： 运行(未调整优先级的) 用户进程的CPU时间                |
| sy   | system: 运行内核进程的CPU时间                                |
| ni   | niced：运行已调整优先级的用户进程的CPU时间                   |
| id   | idle:空闲时间                                                |
| wa   | IO wait: 用于等待IO完成的CPU时间                             |
| hi   | 处理硬件中断的CPU时间                                        |
| si   | 处理软件中断的CPU时间                                        |
| st   | 这个虚拟机被hypervisor偷去的CPU时间（译注：如果当前处于一个hypervisor下的vm，实际上hypervisor也是要消耗一部分CPU处理时间的） |

- **第四行：内存**

全部可用内存、已使用内存、空闲内存、缓冲内存

- **第五行：swap**

全部、已使用、空闲和缓冲交换空间

- **第七行至N行：各进程任务的的状态监控**

| 字段    | 释义                                                         |
| ------- | ------------------------------------------------------------ |
| PID     | 进程ID，进程的唯一标识符                                     |
| USER    | 进程所有者的实际用户名                                       |
| PR      | 进程的调度优先级。这个字段的一些值是'rt'。这意味这这些进程运行在实时态。 |
| NI      | 进程的nice值（优先级）。越小的值意味着越高的优先级。负值表示高优先级，正值表示低优先级 |
| VIRT    | **virtual memory usage 虚拟内存**,进程使用的虚拟内存。进程使用的虚拟内存总量，单位kb。VIRT=SWAP+RES1、进程“需要的”虚拟内存大小，包括进程使用的库、代码、数据等 2、假如进程申请100m的内存，但实际只使用了10m，那么它会增长100m，而不是实际的使用量 |
| RES     | **resident memory usage 常驻内存,**驻留内存大小。驻留内存是任务使用的非交换物理内存大小。进程使用的、未被换出的物理内存大小，单位kb。RES=CODE+DATA1、进程当前使用的内存大小，但不包括swap out 2、包含其他进程的共享 3、如果申请100m的内存，实际使用10m，它只增长10m，与VIRT相反 4、关于库占用内存的情况，它只统计加载的库文件所占内存大小 |
| SHR     | **SHR：shared memory 共享内存**1、除了自身进程的共享内存，也包括其他进程的共享内存 2、虽然进程只使用了几个共享库的函数，但它包含了整个共享库的大小 3、计算某个进程所占的物理内存大小公式：RES – SHR 4、swap out后，它将会降下来 |
| S       | 这个是进程的状态。它有以下不同的值:D - 不可中断的睡眠态。R – 运行态S – 睡眠态T – 被跟踪或已停止Z – 僵尸态 |
| %CPU    | 自从上一次更新时到现在任务所使用的CPU时间百分比。%CPU显示的是进程占用一个核的百分比，而不是整个cpu（N核）的百分比，有时候可能大于100，那是因为该进程启用了多线程占用了多个核心，所以有时候我们看该值得时候会超过100%，但不会超过总核数*100 |
| %MEM    | 进程使用的可用物理内存百分比                                 |
| TIME+   | 任务启动后到现在所使用的全部CPU时间，精确到百分之一秒        |
| COMMAND | 运行进程所使用的命令。进程名称（命令名/命令行）              |

## 交互式命令

默认进入top时，各进程是按照CPU的占用量来排序的。

- **在top基本视图中，按键盘数字“1”可以监控每个逻辑CPU的状况：**

![1575687020229](C:\Users\maoxiangxin\AppData\Roaming\Typora\typora-user-images\1575687020229.png)

- **敲击键盘‘b’（打开关闭加亮效果）top视图变换如下：**

![1575687122598](C:\Users\maoxiangxin\AppData\Roaming\Typora\typora-user-images\1575687122598.png)

PID为59为当前top视图中唯一的运行态进程。也可以敲击键盘‘y’来打开或者关闭运行态进程的加亮效果。

- **敲击键盘‘x’（打开/关闭排序列的加亮效果），top视图变换如下：** 

![1575687194290](C:\Users\maoxiangxin\AppData\Roaming\Typora\typora-user-images\1575687194290.png)

可以看到现在是按"%CPU"进行排序的，可以按”shift+>”或者”shift+<”左右改变排序序列。

- **改变进程显示字段**

在top基本视图中，敲击”f”进入另一个视图，在这里可以编辑基本视图中的显示字段：

![1575687261840](C:\Users\maoxiangxin\AppData\Roaming\Typora\typora-user-images\1575687261840.png)

用上下键选择选项，按下空格键可以决定是否在基本视图中显示这个选项。

top命令是一个非常强大的功能，但是它监控的最小单位是进程，如果想监控更小单位时，就需要用到ps或者netstate命令来满足我们的要求。


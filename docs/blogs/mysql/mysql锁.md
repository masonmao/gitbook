# mysql锁

# 为什么需要锁



# 什么是锁

## lock与latch

latch是一种轻量级的锁，主要是用来保证并发线程操作临街资源的正确性，通常没有死锁检测机制。在innodb存储引擎中分为mutex（互斥锁）和rwlock（读写锁）。

lock的对象是事务，用来锁定数据库中的对象，如表、页、行。lock的对象一般在事务commit或rollback之后释放，又死锁机制。

![img](https://images2015.cnblogs.com/blog/754297/201601/754297-20160131225332443-857830570.jpg)

innodb中的Latch可以通过show engine innodb mutex查看。

锁的类型

Innodb存储引擎有两种标准的行级锁。

**共享锁（S Lock）**：允许事务读一行数据。

**排它锁（X Lock）**：允许事务删除或更新一条数据。

两种锁的兼容性如下：兼容是指对同一行记录的兼容性情况。

|      |   X    |   S    |
| :--: | :----: | :----: |
|  X   | 不兼容 | 不兼容 |
|  S   | 不兼容 |  兼容  |

意向锁

意向锁存在的意义在于，使得行锁和表锁能够共存。意向锁是**表级别**的锁，用来说明事务稍后会对表中的数据行加哪种类型的锁(共享锁或独占锁)。

当一个事务对表加了意向排他锁时，另外一个事务在加锁前就会通过该表的意向排他锁知道前面已经有事务在对该表进行独占操作，从而等待。

意向锁分为意向共享锁和意向排它锁。

**意向共享锁（IS Lock）**：事务想要获取一张表中某几行的共享锁。

**意向排它锁（IX Lock）**：事务想要获取一张表中某几行的排它锁。

意向锁和行级锁的兼容性如下表所示。

|      |   IS   |   IX   |   S    |   X    |
| :--: | :----: | :----: | :----: | :----: |
|  IS  |  兼容  |  兼容  |  兼容  | 不兼容 |
|  IX  |  兼容  |  兼容  | 不兼容 | 不兼容 |
|  S   |  兼容  | 不兼容 |  兼容  | 不兼容 |
|  X   | 不兼容 | 不兼容 | 不兼容 | 不兼容 |

